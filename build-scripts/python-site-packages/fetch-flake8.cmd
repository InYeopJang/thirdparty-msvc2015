@setlocal enableextensions
::
:: Use pip to install Flake 8. We match the versions to those on RHEL7
::
@echo Setting up Flake 8 and dependencies

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Setup environment. Important to ensure correct detection of environment
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call %~dp0..\cmds\common-setup.cmd
@set PYTHON_EXTRAS_DIR=%~dp0..\extras\python

:: Flake8 depends on pep8, pyflakes and mccabe and the versions of these matter
:: for producing consistent results with the builders.
@set PEP8_VERSION=1.6.2
@set PYFLAKES_VERSION=1.3.0
@set MCCABE_VERSION=0.6.1
@set FLAKE8_VERSION=2.5.4

:: flake8 version claims do not seem accurate so we install everything manually
:: The order or installation is important to ensure the dependencies are at the
:: above versions
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install pep8==%PEP8_VERSION%
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install pyflakes==%PYFLAKES_VERSION%
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install mccabe==%MCCABE_VERSION%
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install --no-deps flake8==%FLAKE8_VERSION%

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Post-process
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Remove non-relocatable IPython .exe launchers and generate handwritten ones
set WRITE_LAUNCHER=%PYTHON_EXTRAS_DIR%\write-launcher-script.py
set PYTHON_SITE_PACKAGES=%PYTHON_INSTALL_PREFIX%\Lib\site-packages
%PYTHON_INSTALL_PREFIX%\python.exe %WRITE_LAUNCHER% --rm_exe %PYTHON_SITE_PACKAGES%\pep8-%PEP8_VERSION%.dist-info\entry_points.txt
%PYTHON_INSTALL_PREFIX%\python.exe %WRITE_LAUNCHER% --rm_exe %PYTHON_SITE_PACKAGES%\pyflakes-%PYFLAKES_VERSION%.dist-info\entry_points.txt
%PYTHON_INSTALL_PREFIX%\python.exe %WRITE_LAUNCHER% --rm_exe %PYTHON_SITE_PACKAGES%\flake8-%FLAKE8_VERSION%.dist-info\entry_points.txt

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Finalize
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call try-pause.cmd
goto:eof