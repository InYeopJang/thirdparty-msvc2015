@setlocal enableextensions
::
:: Use pip to install Sphinx + the bootstrap theme
::
@echo Setting up Sphinx + bootstrap theme

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Setup environment. Important to ensure correct detection of environment
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call %~dp0..\cmds\common-setup.cmd
@set PYTHON_EXTRAS_DIR=%~dp0..\extras\python

:: Sphinx depends on Babel and we need to know the version of Babel installed to generate the
:: launcher script later. Simplest way is to fix it ourselves
@set BABEL_VERSION=2.1.1
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install Babel==%BABEL_VERSION%
@set SPHINX_VERSION=1.3.1
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install Sphinx==%SPHINX_VERSION%
@call %PYTHON_INSTALL_PREFIX%\Scripts\pip.cmd install sphinx_bootstrap_theme

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Post-process
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
set WRITE_LAUNCHER=%PYTHON_EXTRAS_DIR%\write-launcher-script.py
set PYTHON_SITE_PACKAGES=%PYTHON_INSTALL_PREFIX%\Lib\site-packages
@call %PYTHON_INSTALL_PREFIX%\python.exe %WRITE_LAUNCHER% --rm_exe %PYTHON_SITE_PACKAGES%\sphinx-%SPHINX_VERSION%.dist-info\entry_points.txt
@call %PYTHON_INSTALL_PREFIX%\python.exe %WRITE_LAUNCHER% --rm_exe %PYTHON_SITE_PACKAGES%\Babel-%BABEL_VERSION%.dist-info\entry_points.txt

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Finalize
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call try-pause.cmd
goto:eof