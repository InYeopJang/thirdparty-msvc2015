@setlocal enableextensions
::
:: Install a subset of pywin32: the whole thing is quite big.
::
@echo Setting up pywin32

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Setup environment. Important to ensure correct detection of environment
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call %~dp0..\..\cmds\common-setup.cmd
@set PYTHON_EXTRAS_DIR=%~dp0..\extras\python

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Download
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: WARNING: The original URL has a %20 specifier but in a bat script %2 would be taken as the second argument to the script
:: so we have to escape the %. As we also pass the URL to a separate cmd script we have to escape it again resulting in %%%%20 
@set SRC_PKG_URL="https://sourceforge.net/projects/pywin32/files/pywin32/Build%20219/pywin32-219.win-amd64-py3.5.exe"
@set SRC_PKG=pywin32-219.win-amd64-py3.5.exe
@set BUILD_DIR=%BUILD_ROOT%\python
@call try-mkdir.cmd %BUILD_DIR%
@cd %BUILD_DIR%
@call download-file.cmd "%SRC_PKG%" %SRC_PKG_URL%

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Extract manually and copy relevant parts
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: The .exe is really just a self-executing archive
@set SRC_ROOT=%BUILD_DIR%\%SRC_PKG:~0,-4%
@if not exist %SRC_ROOT% start %SRC_PKG% 
::call %SRC_PKG%

@echo "cheese"

@cd %SRC_ROOT%\PLATLIB
@set PYTHON_SITE_PACKAGES=%PYTHON35_INSTALL_ROOT%\Lib\site-packages
@set INSTALL_DIRS=adodbapi isapi win32 win32com win32comext
for %%D in (%INSTALL_DIRS%) do (
  xcopy %%D %PYTHON_SITE_PACKAGES%\%%D /Y /I /E
)

@set INSTALL_FILES=pythoncom.py pywin32.pth pywin32.version.txt pywin32-219-py2.7.egg-info
for %%F in (%INSTALL_FILES%) do (
  xcopy %%F %PYTHON_SITE_PACKAGES%\ /Y /I
)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Post-process
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Finalize
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
@call try-pause.cmd
goto:eof